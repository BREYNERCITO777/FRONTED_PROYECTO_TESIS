{"ast":null,"code":"var _jsxFileName = \"D:\\\\PROYECTO DE TESIS A\\xD1O 2026\\\\sistema-armas\\\\frontend\\\\src\\\\app\\\\providers\\\\alerts-context.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// frontend/src/app/providers/alerts-context.tsx\nimport React, { createContext, useContext, useEffect, useMemo, useRef, useState } from \"react\";\nimport { http } from \"../../api/http\"; // ✅ usa tu axios con Bearer\nimport { useAuth } from \"../../context/auth-context\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AlertsContext = /*#__PURE__*/createContext(null);\n\n// API base ya está en axios, pero lo dejamos para WS\nconst WS_BASE = process.env.REACT_APP_WS_BASE || \"ws://localhost:8000\";\nfunction normalizeSeverity(s) {\n  const v = String(s !== null && s !== void 0 ? s : \"medium\").toLowerCase();\n  if (v === \"critical\") return \"critical\";\n  if (v === \"high\") return \"high\";\n  if (v === \"medium\") return \"medium\";\n  return \"low\";\n}\nfunction normalizeConfidence(c) {\n  if (c == null) return null;\n  const n = Number(c);\n  if (!Number.isFinite(n)) return null;\n  // por si viniera 0-100 alguna vez:\n  const v = n > 1 ? n / 100 : n;\n  return Math.max(0, Math.min(1, v));\n}\nfunction normalizeAlert(a) {\n  var _ref, _a$_id, _a$type, _a$title, _a$message, _a$weapon_type, _a$evidence_url, _a$camera_id, _ref2, _a$timestamp;\n  return {\n    _id: String((_ref = (_a$_id = a._id) !== null && _a$_id !== void 0 ? _a$_id : a.id) !== null && _ref !== void 0 ? _ref : \"\"),\n    type: (_a$type = a.type) !== null && _a$type !== void 0 ? _a$type : \"ALERTA\",\n    title: (_a$title = a.title) !== null && _a$title !== void 0 ? _a$title : \"Detección\",\n    message: (_a$message = a.message) !== null && _a$message !== void 0 ? _a$message : \"\",\n    severity: normalizeSeverity(a.severity),\n    weapon_type: (_a$weapon_type = a.weapon_type) !== null && _a$weapon_type !== void 0 ? _a$weapon_type : null,\n    confidence: normalizeConfidence(a.confidence),\n    evidence_url: (_a$evidence_url = a.evidence_url) !== null && _a$evidence_url !== void 0 ? _a$evidence_url : null,\n    camera_id: (_a$camera_id = a.camera_id) !== null && _a$camera_id !== void 0 ? _a$camera_id : null,\n    timestamp: (_ref2 = (_a$timestamp = a.timestamp) !== null && _a$timestamp !== void 0 ? _a$timestamp : a.created_at) !== null && _ref2 !== void 0 ? _ref2 : null,\n    read: !!a.read\n  };\n}\nexport function AlertsProvider({\n  children\n}) {\n  _s();\n  const {\n    user,\n    token\n  } = useAuth();\n  const isAdmin = (user === null || user === void 0 ? void 0 : user.role) === \"admin\";\n  const [alerts, setAlerts] = useState([]);\n  const wsRef = useRef(null);\n  const reconnectTimer = useRef(null);\n  const refresh = async () => {\n    // ✅ axios manda Authorization automáticamente\n    const {\n      data\n    } = await http.get(`/alerts?limit=200`);\n    const arr = (Array.isArray(data) ? data : []).map(normalizeAlert);\n\n    // ✅ ordena por timestamp desc si existe\n    arr.sort((a, b) => {\n      var _b$timestamp, _a$timestamp2;\n      return String((_b$timestamp = b.timestamp) !== null && _b$timestamp !== void 0 ? _b$timestamp : \"\").localeCompare(String((_a$timestamp2 = a.timestamp) !== null && _a$timestamp2 !== void 0 ? _a$timestamp2 : \"\"));\n    });\n    setAlerts(arr);\n  };\n  const markAsRead = async id => {\n    // ✅ operator puede marcar read (si backend lo permite por roles)\n    // optimistic\n    setAlerts(prev => prev.map(a => a._id === id ? {\n      ...a,\n      read: true\n    } : a));\n    try {\n      await http.patch(`/alerts/${id}/read?read=true`);\n    } catch (e) {\n      // rollback\n      setAlerts(prev => prev.map(a => a._id === id ? {\n        ...a,\n        read: false\n      } : a));\n      throw e;\n    }\n  };\n  const markAllAsRead = async () => {\n    const unread = alerts.filter(a => !a.read);\n    if (unread.length === 0) return;\n\n    // optimistic\n    setAlerts(prev => prev.map(a => ({\n      ...a,\n      read: true\n    })));\n    try {\n      await Promise.all(unread.map(a => http.patch(`/alerts/${a._id}/read?read=true`)));\n    } catch (e) {\n      // si falla, refrescamos desde backend\n      await refresh();\n      throw e;\n    }\n  };\n  const deleteAlert = async id => {\n    // ✅ protección UI (backend igual valida)\n    if (!isAdmin) {\n      throw new Error(\"No tienes permisos para eliminar alertas\");\n    }\n    const prev = alerts;\n    setAlerts(p => p.filter(a => a._id !== id));\n    try {\n      await http.delete(`/alerts/${id}`);\n    } catch (e) {\n      setAlerts(prev); // rollback\n      throw e;\n    }\n  };\n  const unreadCount = useMemo(() => alerts.filter(a => !a.read).length, [alerts]);\n\n  // ✅ Carga inicial cuando hay usuario logueado\n  useEffect(() => {\n    if (!user) return;\n    refresh().catch(console.error);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [user === null || user === void 0 ? void 0 : user._id]);\n\n  // ✅ WebSocket: recibe eventos y refresca\n  useEffect(() => {\n    if (!user) return;\n    const connect = () => {\n      if (wsRef.current && (wsRef.current.readyState === WebSocket.OPEN || wsRef.current.readyState === WebSocket.CONNECTING)) {\n        return;\n      }\n      const token = localStorage.getItem(\"token\"); // ✅ lo tienes guardado\n      const qs = token ? `?token=${encodeURIComponent(token)}` : \"\";\n      const ws = new WebSocket(`${WS_BASE}/api/v1/ws${qs}`);\n      wsRef.current = ws;\n      ws.onopen = () => {\n        // console.log(\"WS conectado\");\n      };\n      ws.onmessage = event => {\n        try {\n          const msg = JSON.parse(event.data);\n          if ((msg === null || msg === void 0 ? void 0 : msg.type) === \"ALERTA\") {\n            refresh().catch(console.error);\n          }\n        } catch {}\n      };\n      ws.onclose = () => {\n        if (reconnectTimer.current) window.clearTimeout(reconnectTimer.current);\n        reconnectTimer.current = window.setTimeout(connect, 1500);\n      };\n      ws.onerror = () => {\n        try {\n          ws.close();\n        } catch {}\n      };\n    };\n    connect();\n    return () => {\n      if (reconnectTimer.current) window.clearTimeout(reconnectTimer.current);\n      try {\n        var _wsRef$current;\n        (_wsRef$current = wsRef.current) === null || _wsRef$current === void 0 ? void 0 : _wsRef$current.close();\n      } catch {}\n      wsRef.current = null;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [user === null || user === void 0 ? void 0 : user._id, token]);\n  return /*#__PURE__*/_jsxDEV(AlertsContext.Provider, {\n    value: {\n      alerts,\n      unreadCount,\n      refresh,\n      markAsRead,\n      markAllAsRead,\n      deleteAlert\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 203,\n    columnNumber: 5\n  }, this);\n}\n_s(AlertsProvider, \"1p6iGmwebtWyxQAetd1tx4FA7vE=\", false, function () {\n  return [useAuth];\n});\n_c = AlertsProvider;\nexport function useAlerts() {\n  _s2();\n  const ctx = useContext(AlertsContext);\n  if (!ctx) throw new Error(\"useAlerts debe usarse dentro de <AlertsProvider/>\");\n  return ctx;\n}\n_s2(useAlerts, \"/dMy7t63NXD4eYACoT93CePwGrg=\");\nvar _c;\n$RefreshReg$(_c, \"AlertsProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useMemo","useRef","useState","http","useAuth","jsxDEV","_jsxDEV","AlertsContext","WS_BASE","process","env","REACT_APP_WS_BASE","normalizeSeverity","s","v","String","toLowerCase","normalizeConfidence","c","n","Number","isFinite","Math","max","min","normalizeAlert","a","_ref","_a$_id","_a$type","_a$title","_a$message","_a$weapon_type","_a$evidence_url","_a$camera_id","_ref2","_a$timestamp","_id","id","type","title","message","severity","weapon_type","confidence","evidence_url","camera_id","timestamp","created_at","read","AlertsProvider","children","_s","user","token","isAdmin","role","alerts","setAlerts","wsRef","reconnectTimer","refresh","data","get","arr","Array","isArray","map","sort","b","_b$timestamp","_a$timestamp2","localeCompare","markAsRead","prev","patch","e","markAllAsRead","unread","filter","length","Promise","all","deleteAlert","Error","p","delete","unreadCount","catch","console","error","connect","current","readyState","WebSocket","OPEN","CONNECTING","localStorage","getItem","qs","encodeURIComponent","ws","onopen","onmessage","event","msg","JSON","parse","onclose","window","clearTimeout","setTimeout","onerror","close","_wsRef$current","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAlerts","_s2","ctx","$RefreshReg$"],"sources":["D:/PROYECTO DE TESIS AÑO 2026/sistema-armas/frontend/src/app/providers/alerts-context.tsx"],"sourcesContent":["// frontend/src/app/providers/alerts-context.tsx\r\nimport React, { createContext, useContext, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { http } from \"../../api/http\"; // ✅ usa tu axios con Bearer\r\nimport { useAuth } from \"../../context/auth-context\";\r\n\r\ntype Severity = \"critical\" | \"high\" | \"medium\" | \"low\";\r\n\r\nexport interface AlertApi {\r\n  _id: string;\r\n  type?: string;\r\n  title: string;\r\n  message: string;\r\n  severity: Severity;\r\n  weapon_type?: string | null;\r\n  confidence?: number | null;\r\n  evidence_url?: string | null;\r\n  camera_id?: string | null;\r\n  timestamp?: string | null;\r\n  read?: boolean;\r\n}\r\n\r\ntype AlertsContextValue = {\r\n  alerts: AlertApi[];\r\n  unreadCount: number;\r\n  refresh: () => Promise<void>;\r\n  markAsRead: (id: string) => Promise<void>;\r\n  markAllAsRead: () => Promise<void>;\r\n\r\n  // ✅ NUEVO: borrar por ID (solo admin)\r\n  deleteAlert: (id: string) => Promise<void>;\r\n};\r\n\r\nconst AlertsContext = createContext<AlertsContextValue | null>(null);\r\n\r\n// API base ya está en axios, pero lo dejamos para WS\r\nconst WS_BASE = process.env.REACT_APP_WS_BASE || \"ws://localhost:8000\";\r\n\r\nfunction normalizeSeverity(s: any): Severity {\r\n  const v = String(s ?? \"medium\").toLowerCase();\r\n  if (v === \"critical\") return \"critical\";\r\n  if (v === \"high\") return \"high\";\r\n  if (v === \"medium\") return \"medium\";\r\n  return \"low\";\r\n}\r\n\r\nfunction normalizeConfidence(c: any): number | null {\r\n  if (c == null) return null;\r\n  const n = Number(c);\r\n  if (!Number.isFinite(n)) return null;\r\n  // por si viniera 0-100 alguna vez:\r\n  const v = n > 1 ? n / 100 : n;\r\n  return Math.max(0, Math.min(1, v));\r\n}\r\n\r\nfunction normalizeAlert(a: any): AlertApi {\r\n  return {\r\n    _id: String(a._id ?? a.id ?? \"\"),\r\n    type: a.type ?? \"ALERTA\",\r\n    title: a.title ?? \"Detección\",\r\n    message: a.message ?? \"\",\r\n    severity: normalizeSeverity(a.severity),\r\n    weapon_type: a.weapon_type ?? null,\r\n    confidence: normalizeConfidence(a.confidence),\r\n    evidence_url: a.evidence_url ?? null,\r\n    camera_id: a.camera_id ?? null,\r\n    timestamp: a.timestamp ?? a.created_at ?? null,\r\n    read: !!a.read,\r\n  };\r\n}\r\n\r\nexport function AlertsProvider({ children }: { children: React.ReactNode }) {\r\n  const { user, token } = useAuth();\r\n  const isAdmin = user?.role === \"admin\";\r\n\r\n  const [alerts, setAlerts] = useState<AlertApi[]>([]);\r\n  const wsRef = useRef<WebSocket | null>(null);\r\n  const reconnectTimer = useRef<number | null>(null);\r\n\r\n  const refresh = async () => {\r\n    // ✅ axios manda Authorization automáticamente\r\n    const { data } = await http.get(`/alerts?limit=200`);\r\n    const arr = (Array.isArray(data) ? data : []).map(normalizeAlert);\r\n\r\n    // ✅ ordena por timestamp desc si existe\r\n    arr.sort((a: AlertApi, b: AlertApi) => String(b.timestamp ?? \"\").localeCompare(String(a.timestamp ?? \"\")));\r\n\r\n    setAlerts(arr);\r\n  };\r\n\r\n  const markAsRead = async (id: string) => {\r\n    // ✅ operator puede marcar read (si backend lo permite por roles)\r\n    // optimistic\r\n    setAlerts((prev) => prev.map((a) => (a._id === id ? { ...a, read: true } : a)));\r\n\r\n    try {\r\n      await http.patch(`/alerts/${id}/read?read=true`);\r\n    } catch (e) {\r\n      // rollback\r\n      setAlerts((prev) => prev.map((a) => (a._id === id ? { ...a, read: false } : a)));\r\n      throw e;\r\n    }\r\n  };\r\n\r\n  const markAllAsRead = async () => {\r\n    const unread = alerts.filter((a) => !a.read);\r\n    if (unread.length === 0) return;\r\n\r\n    // optimistic\r\n    setAlerts((prev) => prev.map((a) => ({ ...a, read: true })));\r\n\r\n    try {\r\n      await Promise.all(unread.map((a) => http.patch(`/alerts/${a._id}/read?read=true`)));\r\n    } catch (e) {\r\n      // si falla, refrescamos desde backend\r\n      await refresh();\r\n      throw e;\r\n    }\r\n  };\r\n\r\n  const deleteAlert = async (id: string) => {\r\n    // ✅ protección UI (backend igual valida)\r\n    if (!isAdmin) {\r\n      throw new Error(\"No tienes permisos para eliminar alertas\");\r\n    }\r\n\r\n    const prev = alerts;\r\n    setAlerts((p) => p.filter((a) => a._id !== id));\r\n\r\n    try {\r\n      await http.delete(`/alerts/${id}`);\r\n    } catch (e) {\r\n      setAlerts(prev); // rollback\r\n      throw e;\r\n    }\r\n  };\r\n\r\n  const unreadCount = useMemo(() => alerts.filter((a) => !a.read).length, [alerts]);\r\n\r\n  // ✅ Carga inicial cuando hay usuario logueado\r\n  useEffect(() => {\r\n    if (!user) return;\r\n    refresh().catch(console.error);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [user?._id]);\r\n\r\n  // ✅ WebSocket: recibe eventos y refresca\r\n  useEffect(() => {\r\n    if (!user) return;\r\n\r\n    const connect = () => {\r\n  if (\r\n    wsRef.current &&\r\n    (wsRef.current.readyState === WebSocket.OPEN ||\r\n      wsRef.current.readyState === WebSocket.CONNECTING)\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  const token = localStorage.getItem(\"token\"); // ✅ lo tienes guardado\r\n  const qs = token ? `?token=${encodeURIComponent(token)}` : \"\";\r\n\r\n  const ws = new WebSocket(`${WS_BASE}/api/v1/ws${qs}`);\r\n  wsRef.current = ws;\r\n\r\n  ws.onopen = () => {\r\n    // console.log(\"WS conectado\");\r\n  };\r\n\r\n  ws.onmessage = (event) => {\r\n    try {\r\n      const msg = JSON.parse(event.data);\r\n      if (msg?.type === \"ALERTA\") {\r\n        refresh().catch(console.error);\r\n      }\r\n    } catch {}\r\n  };\r\n\r\n  ws.onclose = () => {\r\n    if (reconnectTimer.current) window.clearTimeout(reconnectTimer.current);\r\n    reconnectTimer.current = window.setTimeout(connect, 1500);\r\n  };\r\n\r\n  ws.onerror = () => {\r\n    try {\r\n      ws.close();\r\n    } catch {}\r\n  };\r\n};\r\n\r\n    connect();\r\n\r\n    return () => {\r\n      if (reconnectTimer.current) window.clearTimeout(reconnectTimer.current);\r\n      try {\r\n        wsRef.current?.close();\r\n      } catch {}\r\n      wsRef.current = null;\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [user?._id, token]);\r\n\r\n  return (\r\n    <AlertsContext.Provider value={{ alerts, unreadCount, refresh, markAsRead, markAllAsRead, deleteAlert }}>\r\n      {children}\r\n    </AlertsContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAlerts() {\r\n  const ctx = useContext(AlertsContext);\r\n  if (!ctx) throw new Error(\"useAlerts debe usarse dentro de <AlertsProvider/>\");\r\n  return ctx;\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}