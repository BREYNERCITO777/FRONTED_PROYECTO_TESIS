{"ast":null,"code":"// frontend/src/api/alerts.ts\nimport { http } from \"./http\";\nfunction normalizeSeverity(s) {\n  const v = String(s !== null && s !== void 0 ? s : \"\").toLowerCase();\n  if (v === \"critical\") return \"critical\";\n  if (v === \"high\") return \"high\";\n  if (v === \"medium\") return \"medium\";\n  return \"low\";\n}\nfunction normalizeConfidence(c) {\n  if (c == null) return undefined;\n  const n = Number(c);\n  if (!Number.isFinite(n)) return undefined;\n  // por si alguna vez viniera 0-100\n  const val = n > 1 ? n / 100 : n;\n  return Math.max(0, Math.min(1, val));\n}\nexport function normalizeAlert(raw) {\n  var _ref, _raw$_id, _raw$title, _raw$message, _ref2, _raw$timestamp, _raw$evidence_url;\n  const _id = String((_ref = (_raw$_id = raw._id) !== null && _raw$_id !== void 0 ? _raw$_id : raw.id) !== null && _ref !== void 0 ? _ref : \"\");\n  return {\n    _id,\n    title: String((_raw$title = raw.title) !== null && _raw$title !== void 0 ? _raw$title : \"Alerta\"),\n    message: String((_raw$message = raw.message) !== null && _raw$message !== void 0 ? _raw$message : \"\"),\n    camera_id: raw.camera_id != null ? String(raw.camera_id) : undefined,\n    weapon_type: raw.weapon_type != null ? String(raw.weapon_type) : undefined,\n    confidence: normalizeConfidence(raw.confidence),\n    severity: normalizeSeverity(raw.severity),\n    read: Boolean(raw.read),\n    timestamp: (_ref2 = (_raw$timestamp = raw.timestamp) !== null && _raw$timestamp !== void 0 ? _raw$timestamp : raw.created_at) !== null && _ref2 !== void 0 ? _ref2 : undefined,\n    evidence_url: (_raw$evidence_url = raw.evidence_url) !== null && _raw$evidence_url !== void 0 ? _raw$evidence_url : undefined\n  };\n}\nexport async function listAlerts(limit = 50) {\n  const {\n    data\n  } = await http.get(`/alerts?limit=${limit}`);\n  const arr = Array.isArray(data) ? data : [];\n  return arr.map(normalizeAlert);\n}\nexport async function markAlertRead(alertId, read = true) {\n  // tu backend: PATCH /alerts/{id}/read?read=true\n  const {\n    data\n  } = await http.patch(`/alerts/${alertId}/read?read=${read}`);\n  return normalizeAlert(data);\n}\nexport async function deleteAlert(alertId) {\n  const {\n    data\n  } = await http.delete(`/alerts/${alertId}`);\n  return data;\n}","map":{"version":3,"names":["http","normalizeSeverity","s","v","String","toLowerCase","normalizeConfidence","c","undefined","n","Number","isFinite","val","Math","max","min","normalizeAlert","raw","_ref","_raw$_id","_raw$title","_raw$message","_ref2","_raw$timestamp","_raw$evidence_url","_id","id","title","message","camera_id","weapon_type","confidence","severity","read","Boolean","timestamp","created_at","evidence_url","listAlerts","limit","data","get","arr","Array","isArray","map","markAlertRead","alertId","patch","deleteAlert","delete"],"sources":["D:/PROYECTO DE TESIS AÃ‘O 2026/sistema-armas/frontend/src/api/alerts.ts"],"sourcesContent":["// frontend/src/api/alerts.ts\r\nimport { http } from \"./http\";\r\n\r\nexport type AlertOut = {\r\n  _id?: string;\r\n  id?: string;\r\n\r\n  title?: string;\r\n  message?: string;\r\n\r\n  camera_id?: string | number;\r\n  weapon_type?: string;\r\n\r\n  confidence?: number; // 0..1 (tu backend lo manda float)\r\n  severity?: string; // critical | high | medium | low\r\n  read?: boolean;\r\n\r\n  created_at?: string;\r\n  timestamp?: string;\r\n  evidence_url?: string;\r\n};\r\n\r\nexport type AlertUI = {\r\n  _id: string;\r\n  title: string;\r\n  message: string;\r\n  camera_id?: string;\r\n  weapon_type?: string;\r\n  confidence?: number; // 0..1\r\n  severity: \"critical\" | \"high\" | \"medium\" | \"low\";\r\n  read: boolean;\r\n  timestamp?: string;\r\n  evidence_url?: string;\r\n};\r\n\r\nfunction normalizeSeverity(s?: string): AlertUI[\"severity\"] {\r\n  const v = String(s ?? \"\").toLowerCase();\r\n  if (v === \"critical\") return \"critical\";\r\n  if (v === \"high\") return \"high\";\r\n  if (v === \"medium\") return \"medium\";\r\n  return \"low\";\r\n}\r\n\r\nfunction normalizeConfidence(c?: number): number | undefined {\r\n  if (c == null) return undefined;\r\n  const n = Number(c);\r\n  if (!Number.isFinite(n)) return undefined;\r\n  // por si alguna vez viniera 0-100\r\n  const val = n > 1 ? n / 100 : n;\r\n  return Math.max(0, Math.min(1, val));\r\n}\r\n\r\nexport function normalizeAlert(raw: any): AlertUI {\r\n  const _id = String(raw._id ?? raw.id ?? \"\");\r\n  return {\r\n    _id,\r\n    title: String(raw.title ?? \"Alerta\"),\r\n    message: String(raw.message ?? \"\"),\r\n    camera_id: raw.camera_id != null ? String(raw.camera_id) : undefined,\r\n    weapon_type: raw.weapon_type != null ? String(raw.weapon_type) : undefined,\r\n    confidence: normalizeConfidence(raw.confidence),\r\n    severity: normalizeSeverity(raw.severity),\r\n    read: Boolean(raw.read),\r\n    timestamp: raw.timestamp ?? raw.created_at ?? undefined,\r\n    evidence_url: raw.evidence_url ?? undefined,\r\n  };\r\n}\r\n\r\nexport async function listAlerts(limit = 50): Promise<AlertUI[]> {\r\n  const { data } = await http.get<AlertOut[]>(`/alerts?limit=${limit}`);\r\n  const arr = Array.isArray(data) ? data : [];\r\n  return arr.map(normalizeAlert);\r\n}\r\n\r\nexport async function markAlertRead(alertId: string, read = true): Promise<AlertUI> {\r\n  // tu backend: PATCH /alerts/{id}/read?read=true\r\n  const { data } = await http.patch<AlertOut>(`/alerts/${alertId}/read?read=${read}`);\r\n  return normalizeAlert(data);\r\n}\r\n\r\nexport async function deleteAlert(alertId: string): Promise<{ deleted: boolean; alert_id: string }> {\r\n  const { data } = await http.delete(`/alerts/${alertId}`);\r\n  return data;\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}