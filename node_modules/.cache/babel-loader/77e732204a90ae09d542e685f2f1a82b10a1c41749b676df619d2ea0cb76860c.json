{"ast":null,"code":"var _jsxFileName = \"D:\\\\PROYECTO DE TESIS A\\xD1O 2026\\\\sistema-armas\\\\frontend\\\\src\\\\app\\\\providers\\\\alerts-context.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// frontend/src/app/providers/alerts-context.tsx\nimport React, { createContext, useContext, useEffect, useMemo, useRef, useState, useCallback } from \"react\";\nimport { http } from \"../../api/http\"; // ✅ axios con Bearer\nimport { useAuth } from \"../../context/auth-context\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AlertsContext = /*#__PURE__*/createContext(null);\n\n// WS base (sin /api/v1)\nconst WS_BASE = process.env.REACT_APP_WS_BASE || \"ws://localhost:8000\";\nfunction normalizeSeverity(s) {\n  const v = String(s !== null && s !== void 0 ? s : \"medium\").toLowerCase();\n  if (v === \"critical\") return \"critical\";\n  if (v === \"high\") return \"high\";\n  if (v === \"medium\") return \"medium\";\n  return \"low\";\n}\nfunction normalizeConfidence(c) {\n  if (c == null) return null;\n  const n = Number(c);\n  if (!Number.isFinite(n)) return null;\n  // por si viniera 0-100:\n  const v = n > 1 ? n / 100 : n;\n  return Math.max(0, Math.min(1, v));\n}\nfunction normalizeAlert(a) {\n  var _ref, _a$_id, _a$type, _a$title, _a$message, _a$weapon_type, _a$evidence_url, _a$camera_id, _ref2, _a$timestamp;\n  return {\n    _id: String((_ref = (_a$_id = a._id) !== null && _a$_id !== void 0 ? _a$_id : a.id) !== null && _ref !== void 0 ? _ref : \"\"),\n    type: (_a$type = a.type) !== null && _a$type !== void 0 ? _a$type : \"ALERTA\",\n    title: (_a$title = a.title) !== null && _a$title !== void 0 ? _a$title : \"Detección\",\n    message: (_a$message = a.message) !== null && _a$message !== void 0 ? _a$message : \"\",\n    severity: normalizeSeverity(a.severity),\n    weapon_type: (_a$weapon_type = a.weapon_type) !== null && _a$weapon_type !== void 0 ? _a$weapon_type : null,\n    confidence: normalizeConfidence(a.confidence),\n    evidence_url: (_a$evidence_url = a.evidence_url) !== null && _a$evidence_url !== void 0 ? _a$evidence_url : null,\n    camera_id: (_a$camera_id = a.camera_id) !== null && _a$camera_id !== void 0 ? _a$camera_id : null,\n    timestamp: (_ref2 = (_a$timestamp = a.timestamp) !== null && _a$timestamp !== void 0 ? _a$timestamp : a.created_at) !== null && _ref2 !== void 0 ? _ref2 : null,\n    read: !!a.read\n  };\n}\nexport function AlertsProvider({\n  children\n}) {\n  _s();\n  const {\n    user,\n    token\n  } = useAuth();\n  const isAdmin = (user === null || user === void 0 ? void 0 : user.role) === \"admin\";\n  const [alerts, setAlerts] = useState([]);\n  const wsRef = useRef(null);\n  const reconnectTimer = useRef(null);\n  const pingTimer = useRef(null);\n  const cleanupWs = useCallback(() => {\n    if (reconnectTimer.current) window.clearTimeout(reconnectTimer.current);\n    reconnectTimer.current = null;\n    if (pingTimer.current) window.clearInterval(pingTimer.current);\n    pingTimer.current = null;\n    try {\n      var _wsRef$current;\n      (_wsRef$current = wsRef.current) === null || _wsRef$current === void 0 ? void 0 : _wsRef$current.close();\n    } catch {}\n    wsRef.current = null;\n  }, []);\n  const refresh = useCallback(async () => {\n    const {\n      data\n    } = await http.get(`/alerts?limit=200`);\n    const arr = (Array.isArray(data) ? data : []).map(normalizeAlert);\n\n    // Ordena por timestamp desc (string ISO)\n    arr.sort((a, b) => {\n      var _b$timestamp, _a$timestamp2;\n      return String((_b$timestamp = b.timestamp) !== null && _b$timestamp !== void 0 ? _b$timestamp : \"\").localeCompare(String((_a$timestamp2 = a.timestamp) !== null && _a$timestamp2 !== void 0 ? _a$timestamp2 : \"\"));\n    });\n    setAlerts(arr);\n  }, []);\n  const markAsRead = useCallback(async id => {\n    // optimistic\n    setAlerts(prev => prev.map(a => a._id === id ? {\n      ...a,\n      read: true\n    } : a));\n    try {\n      await http.patch(`/alerts/${id}/read?read=true`);\n    } catch (e) {\n      // rollback\n      setAlerts(prev => prev.map(a => a._id === id ? {\n        ...a,\n        read: false\n      } : a));\n      throw e;\n    }\n  }, []);\n  const markAllAsRead = useCallback(async () => {\n    setAlerts(prev => {\n      const hasUnread = prev.some(a => !a.read);\n      if (!hasUnread) return prev;\n      return prev.map(a => ({\n        ...a,\n        read: true\n      }));\n    });\n    try {\n      // mejor refrescar si falla algo\n      const unreadIds = alerts.filter(a => !a.read).map(a => a._id);\n      await Promise.all(unreadIds.map(id => http.patch(`/alerts/${id}/read?read=true`)));\n    } catch (e) {\n      await refresh();\n      throw e;\n    }\n  }, [alerts, refresh]);\n  const deleteAlert = useCallback(async id => {\n    if (!isAdmin) throw new Error(\"No tienes permisos para eliminar alertas\");\n    const prev = alerts;\n    setAlerts(p => p.filter(a => a._id !== id));\n    try {\n      await http.delete(`/alerts/${id}`);\n    } catch (e) {\n      setAlerts(prev); // rollback\n      throw e;\n    }\n  }, [alerts, isAdmin]);\n  const unreadCount = useMemo(() => alerts.filter(a => !a.read).length, [alerts]);\n\n  // ✅ Carga inicial: solo cuando hay sesión\n  useEffect(() => {\n    if (!user || !token) return;\n    refresh().catch(console.error);\n  }, [user === null || user === void 0 ? void 0 : user._id, token, refresh]);\n\n  // ✅ WebSocket (solo si hay token). Si no hay token, NO conectar (evita 403 loop)\n  useEffect(() => {\n    // sin sesión -> limpiar\n    if (!user || !token) {\n      cleanupWs();\n      return;\n    }\n    const connect = () => {\n      if (!token) return; // doble seguro\n\n      // evita duplicar conexiones\n      if (wsRef.current && (wsRef.current.readyState === WebSocket.OPEN || wsRef.current.readyState === WebSocket.CONNECTING)) {\n        return;\n      }\n      const qs = `?token=${encodeURIComponent(token)}`;\n      const ws = new WebSocket(`${WS_BASE}/api/v1/ws${qs}`);\n      wsRef.current = ws;\n      ws.onopen = () => {\n        // ✅ ping para mantener viva la conexión y para que el server no “se quede esperando”\n        // (tu server hace websocket.receive(); esto ayuda y evita cortes por idle)\n        if (pingTimer.current) window.clearInterval(pingTimer.current);\n        pingTimer.current = window.setInterval(() => {\n          try {\n            if (ws.readyState === WebSocket.OPEN) ws.send(\"ping\");\n          } catch {}\n        }, 25000);\n      };\n      ws.onmessage = event => {\n        try {\n          const msg = JSON.parse(event.data);\n          if ((msg === null || msg === void 0 ? void 0 : msg.type) === \"ALERTA\") {\n            refresh().catch(console.error);\n          }\n        } catch {\n          // si llega \"pong\" u otros textos, ignorar\n        }\n      };\n      ws.onclose = () => {\n        if (pingTimer.current) window.clearInterval(pingTimer.current);\n        pingTimer.current = null;\n\n        // Si seguimos con sesión (token existe), reconectar\n        if (reconnectTimer.current) window.clearTimeout(reconnectTimer.current);\n        reconnectTimer.current = window.setTimeout(() => {\n          // solo reconectar si token aún existe\n          if (localStorage.getItem(\"token\")) connect();\n        }, 1500);\n      };\n      ws.onerror = () => {\n        try {\n          ws.close();\n        } catch {}\n      };\n    };\n    connect();\n    return () => {\n      cleanupWs();\n    };\n  }, [user === null || user === void 0 ? void 0 : user._id, token, refresh, cleanupWs]);\n  return /*#__PURE__*/_jsxDEV(AlertsContext.Provider, {\n    value: {\n      alerts,\n      unreadCount,\n      refresh,\n      markAsRead,\n      markAllAsRead,\n      deleteAlert\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 240,\n    columnNumber: 5\n  }, this);\n}\n_s(AlertsProvider, \"A+8x8lze4RLTpe62R3COnQFYPG4=\", false, function () {\n  return [useAuth];\n});\n_c = AlertsProvider;\nexport function useAlerts() {\n  _s2();\n  const ctx = useContext(AlertsContext);\n  if (!ctx) throw new Error(\"useAlerts debe usarse dentro de <AlertsProvider/>\");\n  return ctx;\n}\n_s2(useAlerts, \"/dMy7t63NXD4eYACoT93CePwGrg=\");\nvar _c;\n$RefreshReg$(_c, \"AlertsProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useMemo","useRef","useState","useCallback","http","useAuth","jsxDEV","_jsxDEV","AlertsContext","WS_BASE","process","env","REACT_APP_WS_BASE","normalizeSeverity","s","v","String","toLowerCase","normalizeConfidence","c","n","Number","isFinite","Math","max","min","normalizeAlert","a","_ref","_a$_id","_a$type","_a$title","_a$message","_a$weapon_type","_a$evidence_url","_a$camera_id","_ref2","_a$timestamp","_id","id","type","title","message","severity","weapon_type","confidence","evidence_url","camera_id","timestamp","created_at","read","AlertsProvider","children","_s","user","token","isAdmin","role","alerts","setAlerts","wsRef","reconnectTimer","pingTimer","cleanupWs","current","window","clearTimeout","clearInterval","_wsRef$current","close","refresh","data","get","arr","Array","isArray","map","sort","b","_b$timestamp","_a$timestamp2","localeCompare","markAsRead","prev","patch","e","markAllAsRead","hasUnread","some","unreadIds","filter","Promise","all","deleteAlert","Error","p","delete","unreadCount","length","catch","console","error","connect","readyState","WebSocket","OPEN","CONNECTING","qs","encodeURIComponent","ws","onopen","setInterval","send","onmessage","event","msg","JSON","parse","onclose","setTimeout","localStorage","getItem","onerror","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAlerts","_s2","ctx","$RefreshReg$"],"sources":["D:/PROYECTO DE TESIS AÑO 2026/sistema-armas/frontend/src/app/providers/alerts-context.tsx"],"sourcesContent":["// frontend/src/app/providers/alerts-context.tsx\r\nimport React, {\r\n  createContext,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n  useCallback,\r\n} from \"react\";\r\nimport { http } from \"../../api/http\"; // ✅ axios con Bearer\r\nimport { useAuth } from \"../../context/auth-context\";\r\n\r\ntype Severity = \"critical\" | \"high\" | \"medium\" | \"low\";\r\n\r\nexport interface AlertApi {\r\n  _id: string;\r\n  type?: string;\r\n  title: string;\r\n  message: string;\r\n  severity: Severity;\r\n  weapon_type?: string | null;\r\n  confidence?: number | null;\r\n  evidence_url?: string | null;\r\n  camera_id?: string | null;\r\n  timestamp?: string | null;\r\n  read?: boolean;\r\n}\r\n\r\ntype AlertsContextValue = {\r\n  alerts: AlertApi[];\r\n  unreadCount: number;\r\n  refresh: () => Promise<void>;\r\n  markAsRead: (id: string) => Promise<void>;\r\n  markAllAsRead: () => Promise<void>;\r\n  deleteAlert: (id: string) => Promise<void>; // ✅ borrar por ID (solo admin)\r\n};\r\n\r\nconst AlertsContext = createContext<AlertsContextValue | null>(null);\r\n\r\n// WS base (sin /api/v1)\r\nconst WS_BASE = process.env.REACT_APP_WS_BASE || \"ws://localhost:8000\";\r\n\r\nfunction normalizeSeverity(s: any): Severity {\r\n  const v = String(s ?? \"medium\").toLowerCase();\r\n  if (v === \"critical\") return \"critical\";\r\n  if (v === \"high\") return \"high\";\r\n  if (v === \"medium\") return \"medium\";\r\n  return \"low\";\r\n}\r\n\r\nfunction normalizeConfidence(c: any): number | null {\r\n  if (c == null) return null;\r\n  const n = Number(c);\r\n  if (!Number.isFinite(n)) return null;\r\n  // por si viniera 0-100:\r\n  const v = n > 1 ? n / 100 : n;\r\n  return Math.max(0, Math.min(1, v));\r\n}\r\n\r\nfunction normalizeAlert(a: any): AlertApi {\r\n  return {\r\n    _id: String(a._id ?? a.id ?? \"\"),\r\n    type: a.type ?? \"ALERTA\",\r\n    title: a.title ?? \"Detección\",\r\n    message: a.message ?? \"\",\r\n    severity: normalizeSeverity(a.severity),\r\n    weapon_type: a.weapon_type ?? null,\r\n    confidence: normalizeConfidence(a.confidence),\r\n    evidence_url: a.evidence_url ?? null,\r\n    camera_id: a.camera_id ?? null,\r\n    timestamp: a.timestamp ?? a.created_at ?? null,\r\n    read: !!a.read,\r\n  };\r\n}\r\n\r\nexport function AlertsProvider({ children }: { children: React.ReactNode }) {\r\n  const { user, token } = useAuth();\r\n  const isAdmin = user?.role === \"admin\";\r\n\r\n  const [alerts, setAlerts] = useState<AlertApi[]>([]);\r\n\r\n  const wsRef = useRef<WebSocket | null>(null);\r\n  const reconnectTimer = useRef<number | null>(null);\r\n  const pingTimer = useRef<number | null>(null);\r\n\r\n  const cleanupWs = useCallback(() => {\r\n    if (reconnectTimer.current) window.clearTimeout(reconnectTimer.current);\r\n    reconnectTimer.current = null;\r\n\r\n    if (pingTimer.current) window.clearInterval(pingTimer.current);\r\n    pingTimer.current = null;\r\n\r\n    try {\r\n      wsRef.current?.close();\r\n    } catch {}\r\n    wsRef.current = null;\r\n  }, []);\r\n\r\n  const refresh = useCallback(async () => {\r\n    const { data } = await http.get(`/alerts?limit=200`);\r\n    const arr = (Array.isArray(data) ? data : []).map(normalizeAlert);\r\n\r\n    // Ordena por timestamp desc (string ISO)\r\n    arr.sort((a: AlertApi, b: AlertApi) =>\r\n      String(b.timestamp ?? \"\").localeCompare(String(a.timestamp ?? \"\"))\r\n    );\r\n\r\n    setAlerts(arr);\r\n  }, []);\r\n\r\n  const markAsRead = useCallback(async (id: string) => {\r\n    // optimistic\r\n    setAlerts((prev) => prev.map((a) => (a._id === id ? { ...a, read: true } : a)));\r\n\r\n    try {\r\n      await http.patch(`/alerts/${id}/read?read=true`);\r\n    } catch (e) {\r\n      // rollback\r\n      setAlerts((prev) => prev.map((a) => (a._id === id ? { ...a, read: false } : a)));\r\n      throw e;\r\n    }\r\n  }, []);\r\n\r\n  const markAllAsRead = useCallback(async () => {\r\n    setAlerts((prev) => {\r\n      const hasUnread = prev.some((a) => !a.read);\r\n      if (!hasUnread) return prev;\r\n      return prev.map((a) => ({ ...a, read: true }));\r\n    });\r\n\r\n    try {\r\n      // mejor refrescar si falla algo\r\n      const unreadIds = alerts.filter((a) => !a.read).map((a) => a._id);\r\n      await Promise.all(unreadIds.map((id) => http.patch(`/alerts/${id}/read?read=true`)));\r\n    } catch (e) {\r\n      await refresh();\r\n      throw e;\r\n    }\r\n  }, [alerts, refresh]);\r\n\r\n  const deleteAlert = useCallback(\r\n    async (id: string) => {\r\n      if (!isAdmin) throw new Error(\"No tienes permisos para eliminar alertas\");\r\n\r\n      const prev = alerts;\r\n      setAlerts((p) => p.filter((a) => a._id !== id));\r\n\r\n      try {\r\n        await http.delete(`/alerts/${id}`);\r\n      } catch (e) {\r\n        setAlerts(prev); // rollback\r\n        throw e;\r\n      }\r\n    },\r\n    [alerts, isAdmin]\r\n  );\r\n\r\n  const unreadCount = useMemo(() => alerts.filter((a) => !a.read).length, [alerts]);\r\n\r\n  // ✅ Carga inicial: solo cuando hay sesión\r\n  useEffect(() => {\r\n    if (!user || !token) return;\r\n    refresh().catch(console.error);\r\n  }, [user?._id, token, refresh]);\r\n\r\n  // ✅ WebSocket (solo si hay token). Si no hay token, NO conectar (evita 403 loop)\r\n  useEffect(() => {\r\n    // sin sesión -> limpiar\r\n    if (!user || !token) {\r\n      cleanupWs();\r\n      return;\r\n    }\r\n\r\n    const connect = () => {\r\n      if (!token) return; // doble seguro\r\n\r\n      // evita duplicar conexiones\r\n      if (\r\n        wsRef.current &&\r\n        (wsRef.current.readyState === WebSocket.OPEN ||\r\n          wsRef.current.readyState === WebSocket.CONNECTING)\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      const qs = `?token=${encodeURIComponent(token)}`;\r\n      const ws = new WebSocket(`${WS_BASE}/api/v1/ws${qs}`);\r\n      wsRef.current = ws;\r\n\r\n      ws.onopen = () => {\r\n        // ✅ ping para mantener viva la conexión y para que el server no “se quede esperando”\r\n        // (tu server hace websocket.receive(); esto ayuda y evita cortes por idle)\r\n        if (pingTimer.current) window.clearInterval(pingTimer.current);\r\n        pingTimer.current = window.setInterval(() => {\r\n          try {\r\n            if (ws.readyState === WebSocket.OPEN) ws.send(\"ping\");\r\n          } catch {}\r\n        }, 25000);\r\n      };\r\n\r\n      ws.onmessage = (event) => {\r\n        try {\r\n          const msg = JSON.parse(event.data);\r\n          if (msg?.type === \"ALERTA\") {\r\n            refresh().catch(console.error);\r\n          }\r\n        } catch {\r\n          // si llega \"pong\" u otros textos, ignorar\r\n        }\r\n      };\r\n\r\n      ws.onclose = () => {\r\n        if (pingTimer.current) window.clearInterval(pingTimer.current);\r\n        pingTimer.current = null;\r\n\r\n        // Si seguimos con sesión (token existe), reconectar\r\n        if (reconnectTimer.current) window.clearTimeout(reconnectTimer.current);\r\n        reconnectTimer.current = window.setTimeout(() => {\r\n          // solo reconectar si token aún existe\r\n          if (localStorage.getItem(\"token\")) connect();\r\n        }, 1500);\r\n      };\r\n\r\n      ws.onerror = () => {\r\n        try {\r\n          ws.close();\r\n        } catch {}\r\n      };\r\n    };\r\n\r\n    connect();\r\n\r\n    return () => {\r\n      cleanupWs();\r\n    };\r\n  }, [user?._id, token, refresh, cleanupWs]);\r\n\r\n  return (\r\n    <AlertsContext.Provider\r\n      value={{\r\n        alerts,\r\n        unreadCount,\r\n        refresh,\r\n        markAsRead,\r\n        markAllAsRead,\r\n        deleteAlert,\r\n      }}\r\n    >\r\n      {children}\r\n    </AlertsContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAlerts() {\r\n  const ctx = useContext(AlertsContext);\r\n  if (!ctx) throw new Error(\"useAlerts debe usarse dentro de <AlertsProvider/>\");\r\n  return ctx;\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}