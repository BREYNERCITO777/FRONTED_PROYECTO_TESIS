{"ast":null,"code":"import React,{useState,useMemo,useEffect}from\"react\";import{Eye,Filter,AlertTriangle,Download,Camera,Calendar,Shield,Search,MoreHorizontal,X,CheckCircle2,ChevronLeft,ChevronRight,Trash2}from\"lucide-react\";import{listIncidents,deleteIncident}from\"../../../api/incidents\";import{useAuth}from\"../../../context/auth-context\";import{toast}from\"sonner\";// --- Interfaces ---\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";// Base para assets (si luego sirves imágenes desde /static)\nconst PUBLIC_BASE=(process.env.REACT_APP_API_BASE||\"http://localhost:8000/api/v1\").replace(/\\/api\\/v1$/,\"\");// Normaliza lo que venga del backend a tu UI\nfunction normalizeIncident(raw){var _ref,_ref2,_raw$_id,_ref3,_ref4,_raw$weapon_type,_ref5,_raw$confidence,_ref6,_ref7,_raw$camera_id,_ref8,_raw$camera_name,_ref9,_ref0,_raw$created_at,_ref1,_ref10,_raw$image_url;const id=String((_ref=(_ref2=(_raw$_id=raw._id)!==null&&_raw$_id!==void 0?_raw$_id:raw.id)!==null&&_ref2!==void 0?_ref2:raw.incident_id)!==null&&_ref!==void 0?_ref:\"INC-???\");const weapon_type=String((_ref3=(_ref4=(_raw$weapon_type=raw.weapon_type)!==null&&_raw$weapon_type!==void 0?_raw$weapon_type:raw.type)!==null&&_ref4!==void 0?_ref4:raw.label)!==null&&_ref3!==void 0?_ref3:\"Detección\");const confRaw=(_ref5=(_raw$confidence=raw.confidence)!==null&&_raw$confidence!==void 0?_raw$confidence:raw.score)!==null&&_ref5!==void 0?_ref5:0;const confidence=confRaw>1?Number(confRaw)/100:Number(confRaw);const safeConfidence=Number.isFinite(confidence)?Math.max(0,Math.min(1,confidence)):0;const camera_id=String((_ref6=(_ref7=(_raw$camera_id=raw.camera_id)!==null&&_raw$camera_id!==void 0?_raw$camera_id:raw.camera)!==null&&_ref7!==void 0?_ref7:raw.cameraCode)!==null&&_ref6!==void 0?_ref6:\"CAM-?\");const camera_name=String((_ref8=(_raw$camera_name=raw.camera_name)!==null&&_raw$camera_name!==void 0?_raw$camera_name:raw.cameraName)!==null&&_ref8!==void 0?_ref8:\"—\");const created=(_ref9=(_ref0=(_raw$created_at=raw.created_at)!==null&&_raw$created_at!==void 0?_raw$created_at:raw.timestamp)!==null&&_ref0!==void 0?_ref0:raw.createdAt)!==null&&_ref9!==void 0?_ref9:null;const dt=created?new Date(created):new Date();const date=Number.isFinite(dt.getTime())?dt.toLocaleDateString():\"\";const time=Number.isFinite(dt.getTime())?dt.toLocaleTimeString():\"\";const timestamp=created?String(created):\"\".concat(date,\" \").concat(time);// Evidencia / imagen\nconst img=(_ref1=(_ref10=(_raw$image_url=raw.image_url)!==null&&_raw$image_url!==void 0?_raw$image_url:raw.snapshot_url)!==null&&_ref10!==void 0?_ref10:raw.evidence_url)!==null&&_ref1!==void 0?_ref1:\"\";const image_url=typeof img===\"string\"&&img.startsWith(\"/\")?\"\".concat(PUBLIC_BASE).concat(img):String(img||\"\");// Severidad\nconst sev=raw.severity||(safeConfidence>=0.9?\"critical\":safeConfidence>=0.8?\"high\":safeConfidence>=0.7?\"medium\":\"low\");return{id,weapon_type,confidence:safeConfidence,timestamp,date,time,camera_id,camera_name,image_url,severity:sev};}export const Incidents=()=>{var _user$role;const{user}=useAuth();const isAdmin=(user===null||user===void 0?void 0:user.role)===\"admin\";const[loading,setLoading]=useState(true);const[incidents,setIncidents]=useState([]);const[searchTerm,setSearchTerm]=useState(\"\");const[filterCamera,setFilterCamera]=useState(\"all\");const[filterSeverity,setFilterSeverity]=useState(\"all\");const[selectedIncident,setSelectedIncident]=useState(null);const[deleting,setDeleting]=useState(false);// ✅ PAGINACIÓN (5 en 5)\nconst pageSize=5;const[page,setPage]=useState(1);async function refresh(){try{const data=await listIncidents(500);const normalized=Array.isArray(data)?data.map(normalizeIncident):[];normalized.sort((a,b)=>a.timestamp<b.timestamp?1:-1);setIncidents(normalized);}catch(e){var _e$response;console.error(\"listIncidents error:\",e===null||e===void 0?void 0:(_e$response=e.response)===null||_e$response===void 0?void 0:_e$response.status,e===null||e===void 0?void 0:e.message);setIncidents([]);toast.error(\"No se pudieron cargar los incidentes\");}}useEffect(()=>{(async()=>{setLoading(true);await refresh();setLoading(false);})();},[]);const uniqueCameras=useMemo(()=>{const map=new Map();incidents.forEach(inc=>{if(!map.has(inc.camera_id))map.set(inc.camera_id,inc.camera_name);});return Array.from(map.entries());},[incidents]);const filteredIncidents=useMemo(()=>{return incidents.filter(inc=>{const matchesSearch=inc.id.toLowerCase().includes(searchTerm.toLowerCase())||inc.weapon_type.toLowerCase().includes(searchTerm.toLowerCase());const matchesCamera=filterCamera===\"all\"||inc.camera_id===filterCamera;const matchesSeverity=filterSeverity===\"all\"||inc.severity===filterSeverity;return matchesSearch&&matchesCamera&&matchesSeverity;});},[incidents,searchTerm,filterCamera,filterSeverity]);useEffect(()=>{setPage(1);},[searchTerm,filterCamera,filterSeverity]);const totalPages=Math.max(1,Math.ceil(filteredIncidents.length/pageSize));const pageData=useMemo(()=>{const start=(page-1)*pageSize;return filteredIncidents.slice(start,start+pageSize);},[filteredIncidents,page]);useEffect(()=>{if(page>totalPages)setPage(totalPages);},[totalPages,page]);const canPrev=page>1;const canNext=page<totalPages;const goPrev=()=>setPage(p=>Math.max(1,p-1));const goNext=()=>setPage(p=>Math.min(totalPages,p+1));const getSeverityStyles=severity=>{switch(severity){case\"critical\":return\"bg-destructive/10 text-destructive border-destructive/20\";case\"high\":return\"bg-orange-500/10 text-orange-600 border-orange-500/20\";case\"medium\":return\"bg-yellow-500/10 text-yellow-600 border-yellow-500/20\";default:return\"bg-muted text-muted-foreground border-border\";}};const stats=useMemo(()=>({total:filteredIncidents.length,critical:filteredIncidents.filter(i=>i.severity===\"critical\").length,avgConfidence:filteredIncidents.length>0?(filteredIncidents.reduce((acc,curr)=>acc+curr.confidence,0)/filteredIncidents.length*100).toFixed(0):\"0\"}),[filteredIncidents]);const startLabel=filteredIncidents.length===0?0:(page-1)*pageSize+1;const endLabel=Math.min(page*pageSize,filteredIncidents.length);const handleDeleteSelected=async()=>{if(!selectedIncident)return;if(!isAdmin){toast.error(\"No tienes permisos para eliminar incidentes\");return;}setDeleting(true);try{await deleteIncident(selectedIncident.id);toast.success(\"Incidente eliminado\");setSelectedIncident(null);await refresh();}catch(e){var _e$response2;console.error(\"deleteIncident error:\",e===null||e===void 0?void 0:(_e$response2=e.response)===null||_e$response2===void 0?void 0:_e$response2.status,e===null||e===void 0?void 0:e.message);toast.error(\"No se pudo eliminar el incidente (solo admin)\");}finally{setDeleting(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"w-full space-y-6 pb-10 text-foreground\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col lg:flex-row lg:items-center justify-between gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl md:text-3xl font-bold tracking-tight\",children:\"Registro de Incidentes\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted-foreground text-sm mt-1\",children:\"Gesti\\xF3n y auditor\\xEDa de detecciones de seguridad\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-muted-foreground mt-1\",children:[\"Rol: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-foreground\",children:(_user$role=user===null||user===void 0?void 0:user.role)!==null&&_user$role!==void 0?_user$role:\"—\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center gap-3\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>refresh(),className:\"flex-1 lg:flex-none inline-flex items-center justify-center gap-2 px-4 py-2.5 bg-secondary text-secondary-foreground rounded-lg border border-border text-sm font-bold hover:bg-secondary/80 transition-all shadow-sm\",children:[/*#__PURE__*/_jsx(Download,{size:18}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"hidden sm:inline\",children:\"Refrescar\"})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\",children:[{label:\"Total\",val:stats.total,icon:AlertTriangle,color:\"text-primary\",bg:\"bg-primary/10\"},{label:\"Críticos\",val:stats.critical,icon:Shield,color:\"text-destructive\",bg:\"bg-destructive/10\"},{label:\"IA Estable\",val:\"\".concat(stats.avgConfidence,\"%\"),icon:CheckCircle2,color:\"text-emerald-500\",bg:\"bg-emerald-500/10\"},{label:\"Cámaras\",val:uniqueCameras.length,icon:Camera,color:\"text-indigo-500\",bg:\"bg-indigo-500/10\"}].map((stat,i)=>/*#__PURE__*/_jsxs(\"div\",{className:\"bg-card p-5 rounded-lg border border-border shadow-sm flex items-center gap-4 hover:shadow-md transition-shadow\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-3 rounded-md \".concat(stat.bg,\" \").concat(stat.color),children:/*#__PURE__*/_jsx(stat.icon,{size:24})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] font-bold text-muted-foreground uppercase tracking-widest\",children:stat.label}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-2xl font-bold text-card-foreground\",children:stat.val})]})]},i))}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-card p-4 rounded-lg border border-border shadow-sm space-y-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col lg:flex-row gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative flex-1 group\",children:[/*#__PURE__*/_jsx(Search,{className:\"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground group-focus-within:text-primary transition-colors\",size:18}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Buscar por ID o tipo de arma...\",className:\"w-full pl-10 pr-4 py-2 bg-background border border-input rounded-md text-sm focus:ring-2 focus:ring-ring outline-none transition-all\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap items-center gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 bg-background px-3 py-1 rounded-md border border-input\",children:[/*#__PURE__*/_jsx(Filter,{size:14,className:\"text-muted-foreground\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"bg-transparent border-none text-xs font-bold text-foreground outline-none py-1.5 cursor-pointer\",value:filterCamera,onChange:e=>setFilterCamera(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"C\\xE1maras: Todas\"}),uniqueCameras.map(_ref11=>{let[id,name]=_ref11;return/*#__PURE__*/_jsx(\"option\",{value:id,children:name},id);})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 bg-background px-3 py-1 rounded-md border border-input\",children:[/*#__PURE__*/_jsx(Shield,{size:14,className:\"text-muted-foreground\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"bg-transparent border-none text-xs font-bold text-foreground outline-none py-1.5 cursor-pointer\",value:filterSeverity,onChange:e=>setFilterSeverity(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"Severidad: Todas\"}),/*#__PURE__*/_jsx(\"option\",{value:\"critical\",children:\"Cr\\xEDtica\"}),/*#__PURE__*/_jsx(\"option\",{value:\"high\",children:\"Alta\"}),/*#__PURE__*/_jsx(\"option\",{value:\"medium\",children:\"Media\"}),/*#__PURE__*/_jsx(\"option\",{value:\"low\",children:\"Baja\"})]})]})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-card rounded-lg border border-border shadow-sm overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"overflow-x-auto\",children:[/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-left border-collapse min-w-[900px]\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"bg-muted/50 border-b border-border text-muted-foreground text-[10px] font-bold uppercase tracking-widest\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-4\",children:\"Incidente\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-4\",children:\"Detecci\\xF3n\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-4\",children:\"Confianza IA\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-4\",children:\"Ubicaci\\xF3n\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-4\",children:\"Nivel\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-4 text-right\",children:\"Acciones\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"divide-y divide-border\",children:pageData.map(incident=>/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-muted/30 transition-colors group\",children:[/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-mono font-bold text-foreground text-sm\",children:incident.id}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-[10px] text-muted-foreground mt-1 flex items-center gap-1\",children:[/*#__PURE__*/_jsx(Calendar,{size:10}),\" \",incident.date,\" \\xB7 \",incident.time]})]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 rounded-full \".concat(incident.severity===\"critical\"?\"bg-destructive animate-pulse\":\"bg-primary\")}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-bold text-foreground\",children:incident.weapon_type})]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 min-w-[70px] bg-muted h-1.5 rounded-full overflow-hidden\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-full transition-all duration-700 \".concat(incident.confidence>0.9?\"bg-emerald-500\":\"bg-primary\"),style:{width:\"\".concat(incident.confidence*100,\"%\")}})}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs font-mono font-bold text-foreground\",children:[(incident.confidence*100).toFixed(0),\"%\"]})]})}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-xs font-bold text-foreground block\",children:incident.camera_name}),/*#__PURE__*/_jsx(\"span\",{className:\"text-[10px] text-muted-foreground uppercase\",children:incident.camera_id})]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-[10px] font-bold uppercase px-2.5 py-1 rounded-md border shadow-sm \".concat(getSeverityStyles(incident.severity)),children:incident.severity})}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 text-right space-x-1\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setSelectedIncident(incident),className:\"p-2 text-muted-foreground hover:text-primary hover:bg-accent rounded-md transition-all inline-flex items-center gap-2 text-xs font-bold uppercase tracking-wider\",children:[/*#__PURE__*/_jsx(Eye,{size:16}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"hidden xl:inline\",children:\"Detalles\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"p-2 text-muted-foreground hover:text-foreground rounded-md transition-all\",children:/*#__PURE__*/_jsx(MoreHorizontal,{size:18})})]})]},incident.id))})]}),loading&&/*#__PURE__*/_jsx(\"div\",{className:\"py-20 text-center space-y-3 bg-card\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-muted-foreground font-medium\",children:\"Cargando incidentes...\"})}),!loading&&filteredIncidents.length===0&&/*#__PURE__*/_jsxs(\"div\",{className:\"py-20 text-center space-y-3 bg-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"inline-flex p-4 bg-muted rounded-full text-muted-foreground\",children:/*#__PURE__*/_jsx(Search,{size:32})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted-foreground font-medium\",children:\"No se encontraron resultados para tu b\\xFAsqueda\"})]})]}),filteredIncidents.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"border-t border-border px-6 py-3 bg-card flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-muted-foreground font-medium\",children:[\"Mostrando \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-foreground\",children:startLabel}),\" - \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-foreground\",children:endLabel}),\" de\",\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-foreground\",children:filteredIncidents.length})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:goPrev,disabled:!canPrev,className:\"inline-flex items-center gap-1 px-3 py-2 rounded-md border text-xs font-bold transition-all \".concat(canPrev?\"bg-background hover:bg-muted border-border text-foreground\":\"bg-muted/40 border-border text-muted-foreground cursor-not-allowed\"),children:[/*#__PURE__*/_jsx(ChevronLeft,{size:16}),\"Anterior\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs font-bold px-2\",children:[page,\" / \",totalPages]}),/*#__PURE__*/_jsxs(\"button\",{onClick:goNext,disabled:!canNext,className:\"inline-flex items-center gap-1 px-3 py-2 rounded-md border text-xs font-bold transition-all \".concat(canNext?\"bg-background hover:bg-muted border-border text-foreground\":\"bg-muted/40 border-border text-muted-foreground cursor-not-allowed\"),children:[\"Siguiente\",/*#__PURE__*/_jsx(ChevronRight,{size:16})]})]})]})]}),selectedIncident&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-background/80 backdrop-blur-sm animate-in fade-in duration-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-card rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden relative border border-border\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedIncident(null),className:\"absolute top-4 right-4 p-2 bg-muted text-muted-foreground hover:text-foreground rounded-full z-10\",children:/*#__PURE__*/_jsx(X,{size:20})}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-8 space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 border-b border-border pb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-2 bg-destructive/10 text-destructive rounded-lg\",children:/*#__PURE__*/_jsx(AlertTriangle,{size:24})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-xl font-bold text-foreground\",children:[\"Incidente \",selectedIncident.id]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-muted-foreground\",children:selectedIncident.timestamp})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-muted/50 rounded-lg border border-border\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] font-bold text-muted-foreground uppercase mb-1 tracking-widest\",children:\"Detecci\\xF3n\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-bold text-foreground\",children:selectedIncident.weapon_type})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-muted/50 rounded-lg border border-border\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] font-bold text-muted-foreground uppercase mb-1 tracking-widest\",children:\"C\\xE1mara\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-bold text-foreground\",children:selectedIncident.camera_name})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-black rounded-lg overflow-hidden shadow-inner border border-border relative\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-full max-h-[60vh] flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"img\",{src:selectedIncident.image_url,alt:\"Captura de evidencia\",className:\"w-full h-auto max-h-[60vh] object-contain\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute bottom-2 right-2 bg-black/60 text-white text-[10px] px-2 py-1 rounded backdrop-blur-sm\",children:selectedIncident.camera_id})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3 pt-4 border-t border-border\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"flex-1 py-2.5 bg-primary text-primary-foreground font-bold rounded-md shadow-md hover:bg-primary/90 transition-all\",children:\"Descargar Evidencia\"}),isAdmin&&/*#__PURE__*/_jsxs(\"button\",{onClick:handleDeleteSelected,disabled:deleting,className:\"flex-1 py-2.5 font-bold rounded-md transition-all inline-flex items-center justify-center gap-2 \".concat(deleting?\"bg-destructive/60 text-white cursor-not-allowed\":\"bg-destructive text-white hover:bg-destructive/90\"),title:\"Eliminar incidente por ID\",children:[/*#__PURE__*/_jsx(Trash2,{size:18}),deleting?\"Eliminando...\":\"Eliminar\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedIncident(null),className:\"flex-1 py-2.5 bg-secondary text-secondary-foreground font-bold rounded-md hover:bg-secondary/80 transition-all\",children:\"Cerrar\"})]}),!isAdmin&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-muted-foreground\",children:[\"Nota: con rol \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold\",children:\"operator\"}),\" solo puedes visualizar incidentes.\"]})]})]})})]});};export default Incidents;","map":{"version":3,"names":["React","useState","useMemo","useEffect","Eye","Filter","AlertTriangle","Download","Camera","Calendar","Shield","Search","MoreHorizontal","X","CheckCircle2","ChevronLeft","ChevronRight","Trash2","listIncidents","deleteIncident","useAuth","toast","jsx","_jsx","jsxs","_jsxs","PUBLIC_BASE","process","env","REACT_APP_API_BASE","replace","normalizeIncident","raw","_ref","_ref2","_raw$_id","_ref3","_ref4","_raw$weapon_type","_ref5","_raw$confidence","_ref6","_ref7","_raw$camera_id","_ref8","_raw$camera_name","_ref9","_ref0","_raw$created_at","_ref1","_ref10","_raw$image_url","id","String","_id","incident_id","weapon_type","type","label","confRaw","confidence","score","Number","safeConfidence","isFinite","Math","max","min","camera_id","camera","cameraCode","camera_name","cameraName","created","created_at","timestamp","createdAt","dt","Date","date","getTime","toLocaleDateString","time","toLocaleTimeString","concat","img","image_url","snapshot_url","evidence_url","startsWith","sev","severity","Incidents","_user$role","user","isAdmin","role","loading","setLoading","incidents","setIncidents","searchTerm","setSearchTerm","filterCamera","setFilterCamera","filterSeverity","setFilterSeverity","selectedIncident","setSelectedIncident","deleting","setDeleting","pageSize","page","setPage","refresh","data","normalized","Array","isArray","map","sort","a","b","e","_e$response","console","error","response","status","message","uniqueCameras","Map","forEach","inc","has","set","from","entries","filteredIncidents","filter","matchesSearch","toLowerCase","includes","matchesCamera","matchesSeverity","totalPages","ceil","length","pageData","start","slice","canPrev","canNext","goPrev","p","goNext","getSeverityStyles","stats","total","critical","i","avgConfidence","reduce","acc","curr","toFixed","startLabel","endLabel","handleDeleteSelected","success","_e$response2","className","children","onClick","size","val","icon","color","bg","stat","placeholder","value","onChange","target","_ref11","name","incident","style","width","disabled","src","alt","title"],"sources":["D:/PROYECTO DE TESIS AÑO 2026/sistema-armas/frontend/src/modules/incidents/ui/Incidents.tsx"],"sourcesContent":["import React, { useState, useMemo, useEffect } from \"react\";\r\nimport {\r\n  Eye,\r\n  Filter,\r\n  AlertTriangle,\r\n  Download,\r\n  Camera,\r\n  Calendar,\r\n  Shield,\r\n  Search,\r\n  MoreHorizontal,\r\n  X,\r\n  FileText,\r\n  CheckCircle2,\r\n  ChevronLeft,\r\n  ChevronRight,\r\n  Trash2,\r\n} from \"lucide-react\";\r\n\r\nimport { listIncidents, deleteIncident } from \"../../../api/incidents\";\r\nimport { useAuth } from \"../../../context/auth-context\";\r\nimport { toast } from \"sonner\";\r\n\r\n// --- Interfaces ---\r\ninterface Incident {\r\n  id: string;\r\n  weapon_type: string;\r\n  confidence: number; // 0..1\r\n  timestamp: string;\r\n  date: string;\r\n  time: string;\r\n  camera_id: string;\r\n  camera_name: string;\r\n  image_url: string;\r\n  severity: \"critical\" | \"high\" | \"medium\" | \"low\";\r\n}\r\n\r\n// Base para assets (si luego sirves imágenes desde /static)\r\nconst PUBLIC_BASE = (process.env.REACT_APP_API_BASE || \"http://localhost:8000/api/v1\").replace(\r\n  /\\/api\\/v1$/,\r\n  \"\"\r\n);\r\n\r\n// Normaliza lo que venga del backend a tu UI\r\nfunction normalizeIncident(raw: any): Incident {\r\n  const id = String(raw._id ?? raw.id ?? raw.incident_id ?? \"INC-???\");\r\n\r\n  const weapon_type = String(raw.weapon_type ?? raw.type ?? raw.label ?? \"Detección\");\r\n\r\n  const confRaw = raw.confidence ?? raw.score ?? 0;\r\n  const confidence = confRaw > 1 ? Number(confRaw) / 100 : Number(confRaw);\r\n  const safeConfidence = Number.isFinite(confidence) ? Math.max(0, Math.min(1, confidence)) : 0;\r\n\r\n  const camera_id = String(raw.camera_id ?? raw.camera ?? raw.cameraCode ?? \"CAM-?\");\r\n  const camera_name = String(raw.camera_name ?? raw.cameraName ?? \"—\");\r\n\r\n  const created = raw.created_at ?? raw.timestamp ?? raw.createdAt ?? null;\r\n  const dt = created ? new Date(created) : new Date();\r\n\r\n  const date = Number.isFinite(dt.getTime()) ? dt.toLocaleDateString() : \"\";\r\n  const time = Number.isFinite(dt.getTime()) ? dt.toLocaleTimeString() : \"\";\r\n  const timestamp = created ? String(created) : `${date} ${time}`;\r\n\r\n  // Evidencia / imagen\r\n  const img = raw.image_url ?? raw.snapshot_url ?? raw.evidence_url ?? \"\";\r\n  const image_url =\r\n    typeof img === \"string\" && img.startsWith(\"/\") ? `${PUBLIC_BASE}${img}` : String(img || \"\");\r\n\r\n  // Severidad\r\n  const sev =\r\n    raw.severity ||\r\n    (safeConfidence >= 0.9\r\n      ? \"critical\"\r\n      : safeConfidence >= 0.8\r\n      ? \"high\"\r\n      : safeConfidence >= 0.7\r\n      ? \"medium\"\r\n      : \"low\");\r\n\r\n  return {\r\n    id,\r\n    weapon_type,\r\n    confidence: safeConfidence,\r\n    timestamp,\r\n    date,\r\n    time,\r\n    camera_id,\r\n    camera_name,\r\n    image_url,\r\n    severity: sev,\r\n  };\r\n}\r\n\r\nexport const Incidents = () => {\r\n  const { user } = useAuth();\r\n  const isAdmin = user?.role === \"admin\";\r\n\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const [incidents, setIncidents] = useState<Incident[]>([]);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n  const [filterCamera, setFilterCamera] = useState(\"all\");\r\n  const [filterSeverity, setFilterSeverity] = useState(\"all\");\r\n  const [selectedIncident, setSelectedIncident] = useState<Incident | null>(null);\r\n  const [deleting, setDeleting] = useState(false);\r\n\r\n  // ✅ PAGINACIÓN (5 en 5)\r\n  const pageSize = 5;\r\n  const [page, setPage] = useState(1);\r\n\r\n  async function refresh() {\r\n    try {\r\n      const data = await listIncidents(500);\r\n      const normalized = Array.isArray(data) ? data.map(normalizeIncident) : [];\r\n      normalized.sort((a, b) => (a.timestamp < b.timestamp ? 1 : -1));\r\n      setIncidents(normalized);\r\n    } catch (e: any) {\r\n      console.error(\"listIncidents error:\", e?.response?.status, e?.message);\r\n      setIncidents([]);\r\n      toast.error(\"No se pudieron cargar los incidentes\");\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      setLoading(true);\r\n      await refresh();\r\n      setLoading(false);\r\n    })();\r\n  }, []);\r\n\r\n  const uniqueCameras = useMemo(() => {\r\n    const map = new Map<string, string>();\r\n    incidents.forEach((inc) => {\r\n      if (!map.has(inc.camera_id)) map.set(inc.camera_id, inc.camera_name);\r\n    });\r\n    return Array.from(map.entries());\r\n  }, [incidents]);\r\n\r\n  const filteredIncidents = useMemo(() => {\r\n    return incidents.filter((inc) => {\r\n      const matchesSearch =\r\n        inc.id.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        inc.weapon_type.toLowerCase().includes(searchTerm.toLowerCase());\r\n\r\n      const matchesCamera = filterCamera === \"all\" || inc.camera_id === filterCamera;\r\n      const matchesSeverity = filterSeverity === \"all\" || inc.severity === filterSeverity;\r\n\r\n      return matchesSearch && matchesCamera && matchesSeverity;\r\n    });\r\n  }, [incidents, searchTerm, filterCamera, filterSeverity]);\r\n\r\n  useEffect(() => {\r\n    setPage(1);\r\n  }, [searchTerm, filterCamera, filterSeverity]);\r\n\r\n  const totalPages = Math.max(1, Math.ceil(filteredIncidents.length / pageSize));\r\n\r\n  const pageData = useMemo(() => {\r\n    const start = (page - 1) * pageSize;\r\n    return filteredIncidents.slice(start, start + pageSize);\r\n  }, [filteredIncidents, page]);\r\n\r\n  useEffect(() => {\r\n    if (page > totalPages) setPage(totalPages);\r\n  }, [totalPages, page]);\r\n\r\n  const canPrev = page > 1;\r\n  const canNext = page < totalPages;\r\n\r\n  const goPrev = () => setPage((p) => Math.max(1, p - 1));\r\n  const goNext = () => setPage((p) => Math.min(totalPages, p + 1));\r\n\r\n  const getSeverityStyles = (severity: string) => {\r\n    switch (severity) {\r\n      case \"critical\":\r\n        return \"bg-destructive/10 text-destructive border-destructive/20\";\r\n      case \"high\":\r\n        return \"bg-orange-500/10 text-orange-600 border-orange-500/20\";\r\n      case \"medium\":\r\n        return \"bg-yellow-500/10 text-yellow-600 border-yellow-500/20\";\r\n      default:\r\n        return \"bg-muted text-muted-foreground border-border\";\r\n    }\r\n  };\r\n\r\n  const stats = useMemo(\r\n    () => ({\r\n      total: filteredIncidents.length,\r\n      critical: filteredIncidents.filter((i) => i.severity === \"critical\").length,\r\n      avgConfidence:\r\n        filteredIncidents.length > 0\r\n          ? (\r\n              (filteredIncidents.reduce((acc, curr) => acc + curr.confidence, 0) /\r\n                filteredIncidents.length) *\r\n              100\r\n            ).toFixed(0)\r\n          : \"0\",\r\n    }),\r\n    [filteredIncidents]\r\n  );\r\n\r\n  const startLabel = filteredIncidents.length === 0 ? 0 : (page - 1) * pageSize + 1;\r\n  const endLabel = Math.min(page * pageSize, filteredIncidents.length);\r\n\r\n  const handleDeleteSelected = async () => {\r\n    if (!selectedIncident) return;\r\n\r\n    if (!isAdmin) {\r\n      toast.error(\"No tienes permisos para eliminar incidentes\");\r\n      return;\r\n    }\r\n\r\n    setDeleting(true);\r\n    try {\r\n      await deleteIncident(selectedIncident.id);\r\n      toast.success(\"Incidente eliminado\");\r\n      setSelectedIncident(null);\r\n      await refresh();\r\n    } catch (e: any) {\r\n      console.error(\"deleteIncident error:\", e?.response?.status, e?.message);\r\n      toast.error(\"No se pudo eliminar el incidente (solo admin)\");\r\n    } finally {\r\n      setDeleting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full space-y-6 pb-10 text-foreground\">\r\n      {/* 1. Header */}\r\n      <div className=\"flex flex-col lg:flex-row lg:items-center justify-between gap-4\">\r\n        <div>\r\n          <h1 className=\"text-2xl md:text-3xl font-bold tracking-tight\">Registro de Incidentes</h1>\r\n          <p className=\"text-muted-foreground text-sm mt-1\">\r\n            Gestión y auditoría de detecciones de seguridad\r\n          </p>\r\n          <p className=\"text-xs text-muted-foreground mt-1\">\r\n            Rol: <span className=\"font-bold text-foreground\">{user?.role ?? \"—\"}</span>\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-3\">\r\n          <button\r\n            onClick={() => refresh()}\r\n            className=\"flex-1 lg:flex-none inline-flex items-center justify-center gap-2 px-4 py-2.5 bg-secondary text-secondary-foreground rounded-lg border border-border text-sm font-bold hover:bg-secondary/80 transition-all shadow-sm\"\r\n          >\r\n            <Download size={18} /> <span className=\"hidden sm:inline\">Refrescar</span>\r\n          </button>\r\n\r\n          {/* ❌ QUITADO: \"Limpiar\" / deleteAllIncidents */}\r\n        </div>\r\n      </div>\r\n\r\n      {/* 2. Stats */}\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n        {[\r\n          { label: \"Total\", val: stats.total, icon: AlertTriangle, color: \"text-primary\", bg: \"bg-primary/10\" },\r\n          { label: \"Críticos\", val: stats.critical, icon: Shield, color: \"text-destructive\", bg: \"bg-destructive/10\" },\r\n          { label: \"IA Estable\", val: `${stats.avgConfidence}%`, icon: CheckCircle2, color: \"text-emerald-500\", bg: \"bg-emerald-500/10\" },\r\n          { label: \"Cámaras\", val: uniqueCameras.length, icon: Camera, color: \"text-indigo-500\", bg: \"bg-indigo-500/10\" },\r\n        ].map((stat, i) => (\r\n          <div\r\n            key={i}\r\n            className=\"bg-card p-5 rounded-lg border border-border shadow-sm flex items-center gap-4 hover:shadow-md transition-shadow\"\r\n          >\r\n            <div className={`p-3 rounded-md ${stat.bg} ${stat.color}`}>\r\n              <stat.icon size={24} />\r\n            </div>\r\n            <div>\r\n              <p className=\"text-[10px] font-bold text-muted-foreground uppercase tracking-widest\">{stat.label}</p>\r\n              <h3 className=\"text-2xl font-bold text-card-foreground\">{stat.val}</h3>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* 3. Filtros */}\r\n      <div className=\"bg-card p-4 rounded-lg border border-border shadow-sm space-y-4\">\r\n        <div className=\"flex flex-col lg:flex-row gap-4\">\r\n          <div className=\"relative flex-1 group\">\r\n            <Search\r\n              className=\"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground group-focus-within:text-primary transition-colors\"\r\n              size={18}\r\n            />\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Buscar por ID o tipo de arma...\"\r\n              className=\"w-full pl-10 pr-4 py-2 bg-background border border-input rounded-md text-sm focus:ring-2 focus:ring-ring outline-none transition-all\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex flex-wrap items-center gap-3\">\r\n            <div className=\"flex items-center gap-2 bg-background px-3 py-1 rounded-md border border-input\">\r\n              <Filter size={14} className=\"text-muted-foreground\" />\r\n              <select\r\n                className=\"bg-transparent border-none text-xs font-bold text-foreground outline-none py-1.5 cursor-pointer\"\r\n                value={filterCamera}\r\n                onChange={(e) => setFilterCamera(e.target.value)}\r\n              >\r\n                <option value=\"all\">Cámaras: Todas</option>\r\n                {uniqueCameras.map(([id, name]) => (\r\n                  <option key={id} value={id}>\r\n                    {name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-2 bg-background px-3 py-1 rounded-md border border-input\">\r\n              <Shield size={14} className=\"text-muted-foreground\" />\r\n              <select\r\n                className=\"bg-transparent border-none text-xs font-bold text-foreground outline-none py-1.5 cursor-pointer\"\r\n                value={filterSeverity}\r\n                onChange={(e) => setFilterSeverity(e.target.value)}\r\n              >\r\n                <option value=\"all\">Severidad: Todas</option>\r\n                <option value=\"critical\">Crítica</option>\r\n                <option value=\"high\">Alta</option>\r\n                <option value=\"medium\">Media</option>\r\n                <option value=\"low\">Baja</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* 4. Tabla (paginada) */}\r\n      <div className=\"bg-card rounded-lg border border-border shadow-sm overflow-hidden\">\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"w-full text-left border-collapse min-w-[900px]\">\r\n            <thead>\r\n              <tr className=\"bg-muted/50 border-b border-border text-muted-foreground text-[10px] font-bold uppercase tracking-widest\">\r\n                <th className=\"px-6 py-4\">Incidente</th>\r\n                <th className=\"px-6 py-4\">Detección</th>\r\n                <th className=\"px-6 py-4\">Confianza IA</th>\r\n                <th className=\"px-6 py-4\">Ubicación</th>\r\n                <th className=\"px-6 py-4\">Nivel</th>\r\n                <th className=\"px-6 py-4 text-right\">Acciones</th>\r\n              </tr>\r\n            </thead>\r\n\r\n            <tbody className=\"divide-y divide-border\">\r\n              {pageData.map((incident) => (\r\n                <tr key={incident.id} className=\"hover:bg-muted/30 transition-colors group\">\r\n                  <td className=\"px-6 py-4\">\r\n                    <span className=\"font-mono font-bold text-foreground text-sm\">{incident.id}</span>\r\n                    <p className=\"text-[10px] text-muted-foreground mt-1 flex items-center gap-1\">\r\n                      <Calendar size={10} /> {incident.date} · {incident.time}\r\n                    </p>\r\n                  </td>\r\n\r\n                  <td className=\"px-6 py-4\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <div\r\n                        className={`w-2 h-2 rounded-full ${\r\n                          incident.severity === \"critical\" ? \"bg-destructive animate-pulse\" : \"bg-primary\"\r\n                        }`}\r\n                      />\r\n                      <span className=\"text-sm font-bold text-foreground\">{incident.weapon_type}</span>\r\n                    </div>\r\n                  </td>\r\n\r\n                  <td className=\"px-6 py-4\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"flex-1 min-w-[70px] bg-muted h-1.5 rounded-full overflow-hidden\">\r\n                        <div\r\n                          className={`h-full transition-all duration-700 ${\r\n                            incident.confidence > 0.9 ? \"bg-emerald-500\" : \"bg-primary\"\r\n                          }`}\r\n                          style={{ width: `${incident.confidence * 100}%` }}\r\n                        />\r\n                      </div>\r\n                      <span className=\"text-xs font-mono font-bold text-foreground\">\r\n                        {(incident.confidence * 100).toFixed(0)}%\r\n                      </span>\r\n                    </div>\r\n                  </td>\r\n\r\n                  <td className=\"px-6 py-4\">\r\n                    <span className=\"text-xs font-bold text-foreground block\">{incident.camera_name}</span>\r\n                    <span className=\"text-[10px] text-muted-foreground uppercase\">{incident.camera_id}</span>\r\n                  </td>\r\n\r\n                  <td className=\"px-6 py-4\">\r\n                    <span\r\n                      className={`text-[10px] font-bold uppercase px-2.5 py-1 rounded-md border shadow-sm ${getSeverityStyles(\r\n                        incident.severity\r\n                      )}`}\r\n                    >\r\n                      {incident.severity}\r\n                    </span>\r\n                  </td>\r\n\r\n                  <td className=\"px-6 py-4 text-right space-x-1\">\r\n                    <button\r\n                      onClick={() => setSelectedIncident(incident)}\r\n                      className=\"p-2 text-muted-foreground hover:text-primary hover:bg-accent rounded-md transition-all inline-flex items-center gap-2 text-xs font-bold uppercase tracking-wider\"\r\n                    >\r\n                      <Eye size={16} /> <span className=\"hidden xl:inline\">Detalles</span>\r\n                    </button>\r\n                    <button className=\"p-2 text-muted-foreground hover:text-foreground rounded-md transition-all\">\r\n                      <MoreHorizontal size={18} />\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n\r\n          {loading && (\r\n            <div className=\"py-20 text-center space-y-3 bg-card\">\r\n              <p className=\"text-muted-foreground font-medium\">Cargando incidentes...</p>\r\n            </div>\r\n          )}\r\n\r\n          {!loading && filteredIncidents.length === 0 && (\r\n            <div className=\"py-20 text-center space-y-3 bg-card\">\r\n              <div className=\"inline-flex p-4 bg-muted rounded-full text-muted-foreground\">\r\n                <Search size={32} />\r\n              </div>\r\n              <p className=\"text-muted-foreground font-medium\">No se encontraron resultados para tu búsqueda</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* ✅ Footer paginación */}\r\n        {filteredIncidents.length > 0 && (\r\n          <div className=\"border-t border-border px-6 py-3 bg-card flex items-center justify-between\">\r\n            <p className=\"text-xs text-muted-foreground font-medium\">\r\n              Mostrando <span className=\"font-bold text-foreground\">{startLabel}</span>\r\n              {\" - \"}\r\n              <span className=\"font-bold text-foreground\">{endLabel}</span> de{\" \"}\r\n              <span className=\"font-bold text-foreground\">{filteredIncidents.length}</span>\r\n            </p>\r\n\r\n            <div className=\"flex items-center gap-2\">\r\n              <button\r\n                onClick={goPrev}\r\n                disabled={!canPrev}\r\n                className={`inline-flex items-center gap-1 px-3 py-2 rounded-md border text-xs font-bold transition-all ${\r\n                  canPrev\r\n                    ? \"bg-background hover:bg-muted border-border text-foreground\"\r\n                    : \"bg-muted/40 border-border text-muted-foreground cursor-not-allowed\"\r\n                }`}\r\n              >\r\n                <ChevronLeft size={16} />\r\n                Anterior\r\n              </button>\r\n\r\n              <div className=\"text-xs font-bold px-2\">\r\n                {page} / {totalPages}\r\n              </div>\r\n\r\n              <button\r\n                onClick={goNext}\r\n                disabled={!canNext}\r\n                className={`inline-flex items-center gap-1 px-3 py-2 rounded-md border text-xs font-bold transition-all ${\r\n                  canNext\r\n                    ? \"bg-background hover:bg-muted border-border text-foreground\"\r\n                    : \"bg-muted/40 border-border text-muted-foreground cursor-not-allowed\"\r\n                }`}\r\n              >\r\n                Siguiente\r\n                <ChevronRight size={16} />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* 5. Modal Detalle */}\r\n      {selectedIncident && (\r\n        <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-background/80 backdrop-blur-sm animate-in fade-in duration-200\">\r\n          <div className=\"bg-card rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden relative border border-border\">\r\n            <button\r\n              onClick={() => setSelectedIncident(null)}\r\n              className=\"absolute top-4 right-4 p-2 bg-muted text-muted-foreground hover:text-foreground rounded-full z-10\"\r\n            >\r\n              <X size={20} />\r\n            </button>\r\n\r\n            <div className=\"p-8 space-y-6\">\r\n              <div className=\"flex items-center gap-3 border-b border-border pb-4\">\r\n                <div className=\"p-2 bg-destructive/10 text-destructive rounded-lg\">\r\n                  <AlertTriangle size={24} />\r\n                </div>\r\n                <div>\r\n                  <h2 className=\"text-xl font-bold text-foreground\">Incidente {selectedIncident.id}</h2>\r\n                  <p className=\"text-sm text-muted-foreground\">{selectedIncident.timestamp}</p>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div className=\"p-4 bg-muted/50 rounded-lg border border-border\">\r\n                  <p className=\"text-[10px] font-bold text-muted-foreground uppercase mb-1 tracking-widest\">\r\n                    Detección\r\n                  </p>\r\n                  <p className=\"font-bold text-foreground\">{selectedIncident.weapon_type}</p>\r\n                </div>\r\n                <div className=\"p-4 bg-muted/50 rounded-lg border border-border\">\r\n                  <p className=\"text-[10px] font-bold text-muted-foreground uppercase mb-1 tracking-widest\">Cámara</p>\r\n                  <p className=\"font-bold text-foreground\">{selectedIncident.camera_name}</p>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"bg-black rounded-lg overflow-hidden shadow-inner border border-border relative\">\r\n                <div className=\"w-full max-h-[60vh] flex items-center justify-center\">\r\n                  <img\r\n                    src={selectedIncident.image_url}\r\n                    alt=\"Captura de evidencia\"\r\n                    className=\"w-full h-auto max-h-[60vh] object-contain\"\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"absolute bottom-2 right-2 bg-black/60 text-white text-[10px] px-2 py-1 rounded backdrop-blur-sm\">\r\n                  {selectedIncident.camera_id}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"flex gap-3 pt-4 border-t border-border\">\r\n                <button className=\"flex-1 py-2.5 bg-primary text-primary-foreground font-bold rounded-md shadow-md hover:bg-primary/90 transition-all\">\r\n                  Descargar Evidencia\r\n                </button>\r\n\r\n                {/* ✅ SOLO ADMIN: eliminar por ID */}\r\n                {isAdmin && (\r\n                  <button\r\n                    onClick={handleDeleteSelected}\r\n                    disabled={deleting}\r\n                    className={`flex-1 py-2.5 font-bold rounded-md transition-all inline-flex items-center justify-center gap-2 ${\r\n                      deleting\r\n                        ? \"bg-destructive/60 text-white cursor-not-allowed\"\r\n                        : \"bg-destructive text-white hover:bg-destructive/90\"\r\n                    }`}\r\n                    title=\"Eliminar incidente por ID\"\r\n                  >\r\n                    <Trash2 size={18} />\r\n                    {deleting ? \"Eliminando...\" : \"Eliminar\"}\r\n                  </button>\r\n                )}\r\n\r\n                <button\r\n                  onClick={() => setSelectedIncident(null)}\r\n                  className=\"flex-1 py-2.5 bg-secondary text-secondary-foreground font-bold rounded-md hover:bg-secondary/80 transition-all\"\r\n                >\r\n                  Cerrar\r\n                </button>\r\n              </div>\r\n\r\n              {!isAdmin && (\r\n                <p className=\"text-xs text-muted-foreground\">\r\n                  Nota: con rol <span className=\"font-bold\">operator</span> solo puedes visualizar incidentes.\r\n                </p>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Incidents;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}